# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn start
```
## Сборка

```
npm run build
```
или
```
yarn build
```                                                               

## Данные и типы данных, используемые в приложении

* ##### Интерфейс описывающий Карточку продукта

```
interface IProduct {
	_id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: null | number;
	selected: boolean;
}
```

* ##### Форма ввода данных: адреса и выбор способа доставки
```
interface IOrder {
	payment: string;
	total: number;
	address: string;
	email: string;
	phone: string;
	items: string[];
}
```

* #####  Форма ввода данных: email и номера телефона
```
interface IOrderForm {
	payment: string;
	address: string;
	email: string;
	phone: string;
}
```

* ##### Интерфейс описывающий внутренне состояние приложения
```
interface IAppState {
    basket: Product[];
    store: Product[];
	order: IOrder;
	formErrors: FormErrors;
}
```

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API
```
class Api {
    readonly baseUrl: string;
    protected options: RequestInit;

    constructor(baseUrl: string, options: RequestInit = {}) {
       this.baseUrl = baseUrl;
       this.options = options;
       };
    }
```
Содержит в себе базовую логику отправки запросов. В конструктор передеётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный параметрах ендпоинт  и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными,которые будут переданны в JSON в теле запроса, и отправляет эти данные в конечную точку, передаваемую в качестве параметра при вызове. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределён заданием третьего параметра при вызове.
- `handleResponse` - обрабатывает ответ от сервера.
#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек созданных пользователями.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_products: IProduct[]` - массив объектов карточек
- `_preview: string | null` - id карточки, выбранной для просмотра в модальной окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `getProduct(cardId: string): ICard` - возвращает карточку по ее id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
- В каждом классе представления есть логика управления `DOM`-элементами (переключение `css`-селекторов, активация/деактивация кнопок, установка текстовых данных и тд). Это значит, что у них должен быть базовый класс `Component` (или `View`), в котором как раз будут все методы управления `DOM`-элементом.

#### Класс Component
Представляет собой базоыве поля и методы, необходимые для отрисовки компонентов на странице.
```
abstract class Component<T> {
	constructor(protected readonly container: HTMLElement) {}

}
```

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- `constructor(selector: string, events: IEvents)` Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- `modal: HTMLElement` - элемент модального окна
- `events: IEvents` - брокер событий

#### Класс ModalWitBasket
Расширяет класс Modal. Предназначен для реализации модального окна со списком выбранных ранее товаров для дальнейшей покупики. При открытии модального окна сохраняет полученный в параметрах обработчик, который передается для выполнения при сабмите формы.\
После потдверждения данных выполняется переход к оформлению заказа
Поля класса:
- `submitButton: HTMLButtonElement` - Кнопка подтверждения
- `_form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута name формы
- `list: HTMLFormElement` - список ранее выбранных товаров
- `total: string` - сколько требуется к оплате

Методы:
- `getProductList()` - вывoд списка товаров
- `deliteProduct()` - удаляет товар из корзины
- `getTotal()` - выводит общую стоимость товаров в корзине

#### Класс ModalWithOrder
Представляет класс, который наследуется от абстрактного класса Component, создает модальное окно для ввода данных, необходимых для оформления заказа.

Поля класса:
- `submitButton: HTMLButtonElement` - Кнопка подтверждения
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- `cleanValidation()` - очищает поля форм и сбрасывает состояние кнопки при отправке формы
- `setError()` - изменяет активность отображения ошибки под полем ввода
- `showInputError()` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError()` - очищает текст ошибки под указанным полем ввода

#### Класс ModalWithAddress
Расширяет класс ModalOrder. Предназначен для реализации модального окна с полями указания способа оплаты товаров и указания адреса. После отправки указанные данные проверяются на ошибки. Кнопка отпавки формы реагирует на валидность данных, когда данные валидны форма может быть отправленна.

Поля класса:
- `paymentButton: HTMLImageElement` - кнопки для выбора способа оплаты
- `_form: HTMLImageElement` - элемент формы
- `formName: string` - значение атрибута name формы

Методы:
- `setPayment()` - таб с переключением способа оплаты
- `setAddress()` - введённые данные в поле указания адреса 

#### Класс ModalWithContacts
Расширяет класс ModalOrder. Предназначен для реализации модального окна с полями указания адреса электронной почты и указания номера телефона. После отправки указанные данные проверяются на ошибки. В случае успеха появляется модальное окно с информацией об успешном оформлении заказа.

Поля класса:
- `paymentButton: HTMLImageElement` - кнопки для выбора способа оплаты
- `_form: HTMLImageElement` - элемент формы
- `formName: string` - значение атрибута name формы

#### Класс ModalWithSuccessfulRegistation
Расширяет класс ModalOrder. Предназначен для реализации модального окна с указанием информации об успешном оформлении заказа и суммы стоимости заказов в корзине.

Поля класса:
- `closeButton: HTMLImageElement` - кнопки закрытия формы в случае успешноного оформления заказа.
- `total: number` - общая сумма покупки

Методы:
- `setTotal()` - указывает значение общей суммы заказа.


#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, категории скила, стоимости софт-скила. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- `setData` - заполняет атрибуты элементов карточки данными, а так-же управляет отображением корзины удаления на основании данных о текущем пользователе. Корзина удаления будет отображаться только если создатель карточки текущий пользователь.
- `render():` HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- `геттер` id возвращает уникальный id карточки

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `addCard(cardElement: HTMLElement)` для добавления карточек на страницу и сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

- `product:toBasket` - добавление товара в корзину
- `product:selected` - при клике на карточку товара открывается модальное окно с подробной информацией о товаре так же появляется кнопка для возмодности добавления товара в корзину.
- `items:changed` - изменились элементы каталога
- `basket:toggleItem` - при клике на кнопку 'добавить в корзину' внутри модального окна просмотра подробной информации о товаре, происходит добавление товара в корзину 
- `basket:open` - модальное окно со списком добавленных карточек 
- `basket:delite` - удаление товара из корзины 
- `basket:order` - перейти к оформлению заказа из модального окна 'корзины'

- `payment:change` - выбор способа оплаты
- `address:input` - ввод адреса доставки товара
- `order:validation` - уведомление с ошибкой валидности данных формы с вводом способо оплаты и адреса.
- `order:submit` - отправка данных для оплаты и доставки
- `orderFormErrors:change` - изменилось состояние валидации заказа
- `contactsFormErrors:change` - изменилось состояние валидации контактов
- `orderInput:change` - изменились введенные данные
- `contacts:open` - модалное окно для ввода контактных данных
- `email:input` - ввод адреса почты
- `phone:input` - ввод номера телефона
- `contacts:validation` - уведомление с ошибкой валидности данных формы с вводом электронной почты и номера телефона.
- `contasts:submit` - подтвержние контактных данных
- `order:success` - информационое окно с уведомлением успешным оформлением товара
- `modal:close` - закрытие модального окна

